import paho.mqtt.client as mqtt
import json
import random
import time

# Configurações
client_id = "Horta-PI5"
topic = "Horta-PI5/temperatura"
aws_iot_endpoint = "seu-endpoint.iot.regiao.amazonaws.com"
port = 8883

# Função para gerar dados simulados
def generate_sensor_data():
    temperatura = random.uniform(20.0, 30.0)
    umidade = random.uniform(40.0, 60.0)
    return {
        "temperatura": temperatura,
        "umidade": umidade
    }

# Callback quando a conexão é estabelecida
def on_connect(client, userdata, flags, rc):
    print("Conectado com código de resultado " + str(rc))

# Configuração do cliente MQTT
client = mqtt.Client(client_id)
client.on_connect = on_connect

# Configuração de TLS (necessário para AWS IoT Core)
client.tls_set(ca_certs="root-CA.crt", certfile="certificate.pem.crt", keyfile="private.pem.key")

# Conecta ao AWS IoT Core
client.connect(aws_iot_endpoint, port, 60)

# Loop para publicar dados
while True:
    sensor_data = generate_sensor_data()
    client.publish(topic, json.dumps(sensor_data))
    print(f"Publicado: {sensor_data}")
    time.sleep(5)  # Publica a cada 5 segundos